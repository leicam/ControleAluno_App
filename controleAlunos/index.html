<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <title>Controle de Alunos</title>

</head>
<body>
    
    
    <script type="/javascript" src="/classes/Login.js"></script>
    <script type="/javascript" src="/classes/Menu.js"></script>
    <script type="/javascript" src="/classes/Aluno.js"> </script>
    <script type="/javascript" src="/classes/Curso.js"> </script>
    <script type="/javascript" src="/controller/cursoController.js"></script>
    <script type="/javascript" src="/controller/alunoController.js"> </script>

    <!-- VARIAVEIS E FUNCOES GLOBAIS -->
    <script type="text/javascript">
        var usuarios = 
        [
            {nome: 'Joao', senha: '123'},
            {nome: 'Franciele', senha: '123'},
            {nome: 'Ana', senha: '123'},
            {nome: 'Jean', senha: '123'},
            {nome: 'Rodrigo', senha: '123'}
        ];

        paraVoltarTexto = "ou 0 para Voltar:";
        listaCursos = "";
        cursos = [];

        OperacaoSucessoLog = function(){
            alert("Operação realizada com sucesso!");
        };

        TemCursoCadastrado = function(){
            if (cursos.length == 0){
                alert("Nenhum curso cadastrado!");
                return false;
            }
            return true;
        };

     

    </script>

    <!-- CLASSE LOGIN -->
    <script type="text/javascript">

        class Login{
            constructor(){
                Login();
            };
            
        };
        Login = function(){
            do {
                userNome = prompt("Informe o Usuário ou " + paraVoltarTexto);
                
                if (userNome == "" || userNome == null){
                    console.log(userNome);
                    alert("Informe o usuário!");
                    continue;
                } 
                else if (userNome == "0")
                    break;
        
                userPassword = prompt("Informe a senha: ","*****");
        
                if (userPassword == "" || userPassword == null){
                    alert("Informe a senha do usuário!")
                    continue;
                }
                else if (userPassword == "0")
                    braak;
        
                usuarioFound = usuarios.find(function(usuario){
                    return usuario.nome == userNome;
                });  
        
                if (usuarioFound == undefined){
                    alert("Usuário não cadastrado!")
                    continue;
                }
        
                senhaFound = usuarios.find(function(usuario){
                    return usuario.senha == userPassword;
                });  
        
                if (senhaFound == undefined){
                    alert("Senha incorreta!")
                    continue;
                }
        
                new Menu();
        
            } while (userNome != "0" || userPassword != "0");
            if (userNome != "0" || userPassword != "0")
                alert("Operação encerrada!");
            return true;
        };


    </script>

    <!-- CLASSE MENU NAVEGACAO -->
    <script type="text/javascript">
        class Menu{
            constructor(){
                MenuNavegacao();
            };
        };    
        MenuNavegacao = function(){
            var opcoesMenu = "1 - Curso\n" +
                             "2 - Aluno\n" +  
                             "0 - Sair"; 
            do {
                promptMenu = parseInt(prompt(opcoesMenu));
                switch (promptMenu) {
                    case 0:
                        break;
                    case 1:
                        CursoMenu();
                        break;
                    case 2:
                        AlunoMenu();
                        break;
                    default:
                        alert("Opção inválida!");
                        continue;
                };

                
            } while (promptMenu != 01);
        };    
    </script>

    <!-- CLASSE CURSO -->
    <script type="text/javascript">
        class Curso {
            constructor(nome){
                this.codigo = 0;
                this.nome = nome;
                this.mediaAprovacao = 0;
                this.alunos = 0;
            };
        };
        CursoMenu = function(){
            var voltar = false;
            var opcaoUser = 0;
            var opcoesCurso = "1 - Cadastrar Curso\n" +
                              "2 - Excluir Curso\n" +  
                              "3 - Listar Cursos\n" +
                              "0 - Voltar\n"; 
            do{
                voltar = false;
                opcaoUser = parseInt(prompt(`O que deseja fazer? \n${opcoesCurso}`));
                switch (opcaoUser) {
                    case 0:
                        voltar = true;
                        break;
                    case 1:                        
                        InserirCurso();                       
                        break;
                    case 2:
                        ExcluirCurso();                           
                        break;
                    case 3:
                        ListarCursos();
                        break;
                    default:
                        alert("Opção inválida!");
                        continue;
                };

            } while (opcaoUser != 0);
            return voltar;
        };
    </script>

    <!-- CLASSE CURSO CONTROLLER-->
    <script type="text/javascript">
        listaCursos = "";
        class CursoController{

            inserir(curso) {
                cursos.push(curso); 
                OperacaoSucessoLog();                               
            };

            listar() {
                 cursos.forEach(c =>{
                     listaCursos += `Codigo: ${c.codigo}\nNome: ${c.nome}\nmediaAprovacao: ${c.mediaAprovacao}\nAlunos: ${c.alunos}\n\n`;
                 });
                 console.log(listaCursos);
            };

            remover(curso){
                cursos.pop(curso.codigo);                    
                OperacaoSucessoLog();
            };
        };

        InserirCurso = function(){
            var promptCurso = 0;
            do {
                promptCurso = prompt("Informe o Nome do Curso " + paraVoltarTexto); 
                if (promptCurso == "" || promptCurso == null){
                    alert("Informe um curso!");
                    continue;
                }
                else if (promptCurso != "0") {
                    var cursoFind = cursos.find(function(curso){
                        return curso.nome == promptCurso;
                    });
                    if (cursoFind){
                        alert("Curso já cadastrado!")
                        break;
                    }
                    var curso = new Curso();
                    curso.nome = promptCurso;
                    curso.codigo = cursos.length+1;
                    new CursoController().inserir(curso);
                    continue;
                }
            } while (promptCurso != "0");
            return true;
        };

        ExcluirCurso = function(){
            var promptCurso = 0;
            
            if (!TemCursoCadastrado)
                return false;
           
            do {
                promptCurso = prompt("Informe o código do Curso " + paraVoltarTexto); 
                if (promptCurso == "" || promptCurso == null){
                    alert("Informe um curso!");
                    continue;
                }
                else if (promptCurso != "0") {
                    var cursoFind = cursos.find(function(curso){
                        return curso.codigo == promptCurso;
                    });
                    if (cursoFind){
                        new CursoController().remover(cursoFind);
                        break;
                    }
                    else{
                        alert("Curso não cadastrado!");
                        break;
                    };
                };
            } while (promptCurso != "0");
            return true;
        };

        ListarCursos = function(){
            if (!TemCursoCadastrado)
                return false;
            new CursoController().listar();
            return true;
        };
        
    </script>

    <!-- CHAMADA CLASSES -->
    <script type="text/javascript">
        new Login();
    </script>

</body>
</html>